import streamlit as st
import pandas as pd
import matplotlib.pyplot as plt

# -------------------------------
# ê¸°ë³¸ ì„¤ì •
# -------------------------------
st.set_page_config(
    page_title="LunchMate ğŸ±",
    layout="wide"
)

st.title("ğŸ½ï¸ LunchMate")
st.caption("ì§ì¥ì¸ì˜ ìƒí™©ê³¼ ì„ í˜¸ë„ë¥¼ ë¶„ì„í•´ ìµœì ì˜ ì ì‹¬ ì‹ë‹¹ 3ê³³ì„ ì¶”ì²œí•©ë‹ˆë‹¤")

# -------------------------------
# Sidebar (ê²€ìƒ‰ ì¡°ê±´ í•„í„°)
# -------------------------------
st.sidebar.header("ğŸ” ê²€ìƒ‰ ì¡°ê±´")

people = st.sidebar.slider("ì¸ì› ìˆ˜", 1, 10, 5)
distance = st.sidebar.selectbox("ì´ë™ ê±°ë¦¬", ["5ë¶„ ì´ë‚´", "10ë¶„ ì´ë‚´", "ìƒê´€ì—†ìŒ"])
food_type = st.sidebar.multiselect(
    "ìŒì‹ ì¢…ë¥˜",
    ["í•œì‹", "ì¤‘ì‹", "ì¼ì‹", "ì–‘ì‹", "ë¶„ì‹", "ê¸°íƒ€"],
    default=["í•œì‹"]
)

# -------------------------------
# ë©”ì¸ ì…ë ¥ ì˜ì—­
# -------------------------------
st.subheader("ğŸ“ ì˜¤ëŠ˜ì˜ ìƒí™©ì„ ì…ë ¥í•´ ì£¼ì„¸ìš”")

situation = st.text_area(
    "ìì—°ìŠ¤ëŸ½ê²Œ ì…ë ¥í•´ ì£¼ì„¸ìš”",
    placeholder="ì˜ˆ: ì˜¤ëŠ˜ íŒ€ì¥ë‹˜ ëª¨ì‹œê³  5ëª…ì´ì„œ ì¡°ìš©íˆ 1ì‹œê°„ ì•ˆì— ë¨¹ì–´ì•¼ í•´ìš”"
)

col1, col2, col3 = st.columns(3)

with col1:
    if st.button("âš¡ ë¹¨ë¦¬ ë¨¹ê¸°"):
        situation = "ì‹œê°„ì´ ì—†ì–´ì„œ ë¹¨ë¦¬ ë¨¹ì„ ìˆ˜ ìˆëŠ” ê³³ì„ ì°¾ê³  ìˆì–´ìš”"

with col2:
    if st.button("ğŸ‘¥ íŒ€ íšŒì‹"):
        situation = "íŒ€ì›ë“¤ê³¼ ì¡°ìš©íˆ ëŒ€í™”í•  ìˆ˜ ìˆëŠ” ì ì‹¬ íšŒì‹ ì¥ì†Œê°€ í•„ìš”í•´ìš”"

with col3:
    if st.button("ğŸ¥£ í•´ì¥ í•„ìš”"):
        situation = "ì–´ì œ ìˆ ì„ ë§ˆì…”ì„œ í•´ì¥ì— ì¢‹ì€ ìŒì‹ì„ ë¨¹ê³  ì‹¶ì–´ìš”"

st.write("")

# -------------------------------
# ì¶”ì²œ ë²„íŠ¼
# -------------------------------
if st.button("ğŸ¤– ì ì‹¬ ì¶”ì²œ ë°›ê¸°") and situation:

    # -------------------------------
    # (Mock) ì¶”ì²œ ê²°ê³¼
    # -------------------------------
    recommendations = [
        {
            "rank": 1,
            "name": "ì •ê°ˆí•œ í•œì •ì‹",
            "reason": "ë£¸ì´ ìˆì–´ 5ëª…ì´ ì¡°ìš©íˆ ì‹ì‚¬í•˜ê¸° ì¢‹ê³  íšŒì „ìœ¨ì´ ë¹ ë¦…ë‹ˆë‹¤",
            "rating": 4.6,
            "distance": 5,
            "price": 12000
        },
        {
            "rank": 2,
            "name": "ì§ì¥ì¸ ë°±ë°˜ì§‘",
            "reason": "ë¹ ë¥¸ ì œê³µê³¼ ê°€ì„±ë¹„ë¡œ ì ì‹¬ì‹œê°„ì„ íš¨ìœ¨ì ìœ¼ë¡œ ì“¸ ìˆ˜ ìˆìŠµë‹ˆë‹¤",
            "rating": 4.4,
            "distance": 3,
            "price": 9000
        },
        {
            "rank": 3,
            "name": "ì†Œë‹´í•œ ì¼ì‹ì§‘",
            "reason": "ì¡°ìš©í•œ ë¶„ìœ„ê¸°ì™€ ì•ˆì •ì ì¸ ë©”ë‰´ êµ¬ì„±ìœ¼ë¡œ í˜¸ë¶ˆí˜¸ê°€ ì ìŠµë‹ˆë‹¤",
            "rating": 4.2,
            "distance": 7,
            "price": 13000
        }
    ]

    df = pd.DataFrame(recommendations)

    # -------------------------------
    # í•œ ì¤„ ê²°ë¡ 
    # -------------------------------
    st.success("â±ï¸ **ë¹ ë¥¸ ì‹ì‚¬ì™€ ì¡°ìš©í•œ ë¶„ìœ„ê¸°ê°€ ì¤‘ìš”í•˜ë‹¤ë©´ 1ë²ˆ ì‹ë‹¹ì´ ê°€ì¥ ì í•©í•©ë‹ˆë‹¤.**")

    # -------------------------------
    # ì¶”ì²œ ì¹´ë“œ
    # -------------------------------
    st.subheader("ğŸ† ì¶”ì²œ ì‹ë‹¹ TOP 3")

    for r in recommendations:
        with st.container():
            st.markdown(f"### {r['rank']}ï¸âƒ£ {r['name']}")
            st.write(f"ğŸ“Œ ì¶”ì²œ ì´ìœ : {r['reason']}")
            st.write(f"â­ í‰ì : {r['rating']} | ğŸš¶ {r['distance']}ë¶„ | ğŸ’° {r['price']}ì›")
            st.divider()

    # -------------------------------
    # ë¹„êµ ì°¨íŠ¸
    # -------------------------------
    st.subheader("ğŸ“Š ì‹ë‹¹ ì§€í‘œ ë¹„êµ")

    fig, ax = plt.subplots()
    ax.bar(df["name"], df["rating"])
    ax.set_ylabel("í‰ì ")
    ax.set_ylim(0, 5)

    st.pyplot(fig)

else:
    st.info("ğŸ‘† ìƒí™©ì„ ì…ë ¥í•˜ê³  **ì ì‹¬ ì¶”ì²œ ë°›ê¸°** ë²„íŠ¼ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”")
